"oracle"
"SELECT
    employee_id,
    LPAD(' ', (LEVEL - 1) * 2) || first_name || ' ' || last_name AS employee_name,
    LEVEL AS hierarchy_level,
    manager_id,
    job_id
FROM
    employees
START WITH
    manager_id IS NULL
CONNECT BY
    PRIOR employee_id = manager_id
ORDER SIBLINGS BY
    last_name, first_name;"
"SELECT
    d.department_name,
    e_ranked.first_name,
    e_ranked.last_name,
    e_ranked.salary,
    e_ranked.rank_in_dept
FROM
    departments d,
    (
        SELECT
            e.employee_id,
            e.first_name,
            e.last_name,
            e.salary,
            e.department_id,
            ROW_NUMBER() OVER (PARTITION BY e.department_id ORDER BY e.salary DESC NULLS LAST) as rank_in_dept
        FROM
            employees e
    ) e_ranked
WHERE
    d.department_id = e_ranked.department_id(+)
    AND (e_ranked.rank_in_dept <= 2 OR e_ranked.rank_in_dept IS NULL)
ORDER BY
    d.department_name, e_ranked.rank_in_dept;"
"SELECT
    e.first_name || ' ' || e.last_name AS employee_name,
    TO_CHAR(e.hire_date, 'DD-MON-YYYY') AS formatted_hire_date,
    TRUNC(MONTHS_BETWEEN(SYSDATE, e.hire_date) / 12) AS tenure_years,
    NVL(e.commission_pct, 0) AS commission_value,
    DECODE(NVL(e.commission_pct, 0), 0, 'Non-Commissioned', 'Commissioned') AS commission_status,
    NVL(m.first_name || ' ' || m.last_name, 'No Manager') AS manager_name
FROM
    employees e
LEFT JOIN
    employees m ON e.manager_id = m.employee_id
ORDER BY
    tenure_years DESC;"
"SELECT
    p.project_name,
    COUNT(CASE WHEN ep.role = 'Lead Developer' THEN ep.employee_id END) AS lead_developers,
    COUNT(CASE WHEN ep.role = 'QA Engineer' THEN ep.employee_id END) AS qa_engineers,
    COUNT(CASE WHEN ep.role = 'Project Manager' THEN ep.employee_id END) AS project_managers,
    COUNT(CASE WHEN ep.role NOT IN ('Lead Developer', 'QA Engineer', 'Project Manager') OR ep.role IS NULL THEN ep.employee_id END) AS other_roles
FROM
    projects p
LEFT JOIN
    employee_projects ep ON p.project_id = ep.project_id
GROUP BY
    p.project_name
ORDER BY
    p.project_name;"
"MERGE INTO employees TGT
USING (
    SELECT
        'Emily' AS first_name,
        'Davis' AS last_name,
        'emily.davis@example.com' AS email,
        '555-0106' AS phone_number,
        TO_DATE('2022-01-15', 'YYYY-MM-DD') AS hire_date,
        'SENIOR_ENGINEER' AS job_id,
        82000 AS salary,
        NULL AS commission_pct,
        (SELECT employee_id FROM employees WHERE email = 'alice.johnson@example.com') AS manager_id,
        (SELECT department_id FROM departments WHERE department_name = 'Engineering') AS department_id
    FROM DUAL
) SRC
ON (TGT.email = SRC.email)
WHEN MATCHED THEN
    UPDATE SET
        TGT.salary = SRC.salary,
        TGT.job_id = SRC.job_id,
        TGT.phone_number = SRC.phone_number
WHEN NOT MATCHED THEN
    INSERT (first_name, last_name, email, phone_number, hire_date, job_id, salary, commission_pct, manager_id, department_id)
    VALUES (SRC.first_name, SRC.last_name, SRC.email, SRC.phone_number, SRC.hire_date, SRC.job_id, SRC.salary, SRC.commission_pct, SRC.manager_id, SRC.department_id);"
"MERGE INTO employees TGT
USING (
    SELECT
        'Kevin' AS first_name,
        'Spacey' AS last_name,
        'kevin.spacey@example.com' AS email,
        '555-0199' AS phone_number,
        SYSDATE AS hire_date,
        'ARCHITECT' AS job_id,
        120000 AS salary,
        NULL AS commission_pct,
        (SELECT employee_id FROM employees WHERE email = 'alice.johnson@example.com') AS manager_id,
        (SELECT department_id FROM departments WHERE department_name = 'Engineering') AS department_id
    FROM DUAL
) SRC
ON (TGT.email = SRC.email)
WHEN MATCHED THEN
    UPDATE SET
        TGT.salary = SRC.salary,
        TGT.job_id = SRC.job_id
WHEN NOT MATCHED THEN
    INSERT (first_name, last_name, email, phone_number, hire_date, job_id, salary, commission_pct, manager_id, department_id)
    VALUES (SRC.first_name, SRC.last_name, SRC.email, SRC.phone_number, SRC.hire_date, SRC.job_id, SRC.salary, SRC.commission_pct, SRC.manager_id, SRC.department_id);"
"SELECT
    e.first_name || ' ' || e.last_name AS employee_name,
    e.salary,
    d.department_name,
    e.hire_date,
    SUM(e.salary) OVER (PARTITION BY e.department_id ORDER BY e.hire_date, e.employee_id ROWS UNBOUNDED PRECEDING) AS running_total_salary,
    e.salary - AVG(e.salary) OVER (PARTITION BY e.department_id) AS diff_from_dept_avg_salary
FROM
    employees e
JOIN
    departments d ON e.department_id = d.department_id
WHERE
    d.department_name = 'Engineering'
ORDER BY
    d.department_name, e.hire_date, e.employee_id;"
"SELECT
    d.department_name,
    LISTAGG(e.first_name || ' ' || e.last_name, ', ') WITHIN GROUP (ORDER BY e.hire_date) AS employee_list
FROM
    departments d
LEFT JOIN
    employees e ON d.department_id = e.department_id
GROUP BY
    d.department_id, d.department_name
ORDER BY
    d.department_name;"
